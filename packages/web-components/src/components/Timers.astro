---
---
<x-timers>
  <button aria-label="add-timer">Add timer</button>
  <button aria-label="clear-timers">Clear timers</button>
  <div aria-label="timers">
  </div>
</x-timers>

<script>
  class Timer extends HTMLElement {
    count: number;
    countSpan: HTMLElement;
    timerId: number;

    constructor() {
      super();
      this.count = 0;
      this.countSpan = document.createElement("span");
      
      this.timerId = setInterval(() => {
        console.log("Timer called");

        this.count++; 
        this.countSpan.textContent = this.count.toString();
      }, 1000);
    }

    connectedCallback() {
      console.log("x-timer connected");

      const countParagraph = document.createElement("p");
      countParagraph.textContent = "Count: ";
      this.countSpan.textContent = this.count.toString();

      countParagraph.appendChild(this.countSpan);
      this.appendChild(countParagraph);
    }

    disconnectedCallback() {
      console.log("x-timer disconnected");

      clearInterval(this.timerId);
    } 
  }

  class Timers extends HTMLElement {
    constructor() {
      super();

      const timersDiv = this.querySelector("[aria-label='timers']");
      const addTimerButton = this.querySelector("[aria-label='add-timer']");
      const clearTimersButton = this.querySelector("[aria-label='clear-timers']");

      // Default state
      timersDiv.textContent = "No timers running";

      clearTimersButton?.addEventListener("click", () => {
        // Return to default state
        timersDiv.textContent = "No timers running";
      });

      addTimerButton?.addEventListener("click", () => {
        // Clear timers div if no timers present
        if (timersDiv.textContent === "No timers running") {
          timersDiv.textContent = null;
        }
        const xTimer = document.createElement("x-timer");
        timersDiv.appendChild(xTimer);
      });
    }
    
    connectedCallback() {
      console.log("x-timers connected");
    }
  }

  customElements.define("x-timer", Timer);
  customElements.define("x-timers", Timers);
</script>
